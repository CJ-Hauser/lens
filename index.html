<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Homework Solver</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 32px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .bookmarklet-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .bookmarklet-section h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
        }

        .bookmarklet-button {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            cursor: move;
            transition: transform 0.2s;
        }

        .bookmarklet-button:hover {
            transform: translateY(-2px);
        }

        .instructions {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #555;
        }

        .instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .result-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .result-section h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        .image-preview {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .solution {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 8px;
            padding: 20px;
            color: #c33;
        }

        .imgbb-setup {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .imgbb-setup h3 {
            color: #1565C0;
            margin-bottom: 10px;
        }

        .imgbb-setup p {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .imgbb-setup a {
            color: #667eea;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            opacity: 0.9;
        }

        .api-info {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö AI Homework Solver</h1>
            <p>Select any problem on any website, and get instant AI-powered solutions with Gemini</p>
        </div>

        <div class="bookmarklet-section">
            <h2>üîñ Setup Instructions</h2>
            
            <div class="api-info">
                <strong>‚úÖ Powered by Pollinations AI (Gemini-Fast)</strong>
                <p style="margin-top: 8px;">Free, fast AI solving with no additional setup required!</p>
            </div>

            <div class="imgbb-setup">
                <h3>üì∏ ImgBB API Key Required</h3>
                <p>To upload screenshots, you need a free ImgBB API key:</p>
                <p>1. Visit <a href="https://api.imgbb.com/" target="_blank">https://api.imgbb.com/</a></p>
                <p>2. Sign up for free and get your API key</p>
                <p>3. Enter it below:</p>
                <input type="text" id="apiKeyInput" placeholder="Paste your ImgBB API key here">
                <button onclick="saveApiKey()">Save API Key</button>
                <p style="margin-top: 10px; font-size: 14px;" id="apiStatus"></p>
            </div>

            <div style="margin-top: 30px;">
                <p style="margin-bottom: 15px; color: #555;">Drag this button to your bookmarks bar:</p>
                <a href="javascript:(function(){if(!window.homeworkSolverActive){window.homeworkSolverActive=true;const overlay=document.createElement('div');overlay.id='hw-solver-overlay';overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(102,126,234,0.3);z-index:999999;cursor:crosshair';document.body.appendChild(overlay);const instruction=document.createElement('div');instruction.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:white;padding:20px 30px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:1000000;font-family:system-ui;font-size:16px;color:#333';instruction.textContent='Hold Shift and drag to select an area';document.body.appendChild(instruction);let startX,startY,selectionBox;overlay.addEventListener('mousedown',e=>{if(!e.shiftKey)return;startX=e.clientX;startY=e.clientY;selectionBox=document.createElement('div');selectionBox.style.cssText='position:fixed;border:3px solid #667eea;background:rgba(102,126,234,0.2);z-index:1000000;pointer-events:none';document.body.appendChild(selectionBox)});overlay.addEventListener('mousemove',e=>{if(!selectionBox||!e.shiftKey)return;const currentX=e.clientX;const currentY=e.clientY;const left=Math.min(startX,currentX);const top=Math.min(startY,currentY);const width=Math.abs(currentX-startX);const height=Math.abs(currentY-startY);selectionBox.style.left=left+'px';selectionBox.style.top=top+'px';selectionBox.style.width=width+'px';selectionBox.style.height=height+'px'});overlay.addEventListener('mouseup',async e=>{if(!selectionBox)return;const rect=selectionBox.getBoundingClientRect();overlay.remove();instruction.remove();selectionBox.remove();window.homeworkSolverActive=false;const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');const scale=window.devicePixelRatio||1;canvas.width=rect.width*scale;canvas.height=rect.height*scale;ctx.scale(scale,scale);try{const stream=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:'screen'}});const video=document.createElement('video');video.srcObject=stream;video.play();await new Promise(resolve=>video.onloadedmetadata=resolve);ctx.drawImage(video,rect.left,rect.top,rect.width,rect.height,0,0,rect.width,rect.height);stream.getTracks().forEach(track=>track.stop());canvas.toBlob(async blob=>{const formData=new FormData();formData.append('image',blob);const apiKey=localStorage.getItem('imgbbApiKey');if(!apiKey){alert('Please set your ImgBB API key first!');return}const response=await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`,{method:'POST',body:formData});const data=await response.json();if(data.data){const solverUrl='https://cj-hauser.github.io/lens/?image='+encodeURIComponent(data.data.url);window.open(solverUrl,'_blank')}else{alert('Upload failed: '+(data.error?.message||'Unknown error'))}})}catch(err){alert('Screenshot failed: '+err.message);window.homeworkSolverActive=false}})}})();" class="bookmarklet-button">üîç Solve Homework</a>
            </div>

            <div class="instructions">
                <h3 style="margin-bottom: 15px; color: #333;">How to use:</h3>
                <ol>
                    <li>First, enter your ImgBB API key above</li>
                    <li>Drag the "Solve Homework" button to your bookmarks bar</li>
                    <li>Navigate to any website with a problem (IXL, Khan Academy, etc.)</li>
                    <li>Click the bookmarklet in your bookmarks bar</li>
                    <li>Hold Shift and drag to select the problem area</li>
                    <li>The solution will open in a new tab automatically!</li>
                </ol>
            </div>
        </div>

        <div class="result-section" id="resultSection">
            <h2>Solution</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        const POLLINATIONS_API_KEY = 'sk_QhVJoNm1mY2XIAo8MXnwvrCGO4HXvDYw';

        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                localStorage.setItem('imgbbApiKey', apiKey);
                document.getElementById('apiStatus').textContent = '‚úÖ API Key saved!';
                document.getElementById('apiStatus').style.color = '#28a745';
            } else {
                document.getElementById('apiStatus').textContent = '‚ùå Please enter a valid API key';
                document.getElementById('apiStatus').style.color = '#dc3545';
            }
        }

        // Check if API key exists
        window.addEventListener('DOMContentLoaded', () => {
            const apiKey = localStorage.getItem('imgbbApiKey');
            if (apiKey) {
                document.getElementById('apiKeyInput').value = apiKey;
                document.getElementById('apiStatus').textContent = '‚úÖ API Key loaded';
                document.getElementById('apiStatus').style.color = '#28a745';
            }
        });

        // Check for image parameter in URL
        const urlParams = new URLSearchParams(window.location.search);
        const imageUrl = urlParams.get('image');

        if (imageUrl) {
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');
            
            resultSection.classList.add('active');
            resultContent.innerHTML = `
                <img src="${imageUrl}" class="image-preview" alt="Problem">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing problem with Gemini AI...</p>
                </div>
            `;

            // Solve the problem using Pollinations API
            solveProblem(imageUrl);
        }

        async function solveProblem(imageUrl) {
            const resultContent = document.getElementById('resultContent');
            
            try {
                // Convert image URL to base64
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const base64 = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });

                // Call Pollinations API with Gemini
                const apiResponse = await fetch('https://gen.pollinations.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${POLLINATIONS_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gemini-fast',
                        messages: [
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'image_url',
                                        image_url: {
                                            url: base64
                                        }
                                    },
                                    {
                                        type: 'text',
                                        text: 'Please solve this problem step by step. Show your work and explain the reasoning clearly. If this is a math problem, show all calculations. If this is a reading comprehension or other subject, provide a thorough answer with explanations.'
                                    }
                                ]
                            }
                        ],
                        max_tokens: 2000
                    })
                });

                if (!apiResponse.ok) {
                    throw new Error(`API error: ${apiResponse.status} ${apiResponse.statusText}`);
                }

                const data = await apiResponse.json();
                const solution = data.choices[0].message.content;

                resultContent.innerHTML = `
                    <img src="${imageUrl}" class="image-preview" alt="Problem">
                    <div class="solution">${solution}</div>
                `;
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = `
                    <img src="${imageUrl}" class="image-preview" alt="Problem">
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                        <br><br>
                        Please make sure the image is accessible and try again.
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
